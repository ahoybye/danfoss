<apex:page id="thpage" standardController="BMCServiceDesk__Problem__c" extensions="BMCServiceDesk.ConsoleProblemDetailController,BMCServiceDesk.ConsoleRemoteActions" standardStylesheets="true" showHeader="false" sidebar="false" >
<head>
	<link rel="stylesheet" href="{!$Resource.SDEFStyles}/ConsoleDetail.css" type="text/css" />
	<script type="text/javascript" src="{!$Resource.SDEFCommonJS}/HTML_ENCODE_DECODE.js"></script>
</head>

<body onload="doOnLoadActivity()">
    <apex:form id="theForm">
    <apex:actionFunction name="calculateDueDate" action="{!calculateDueDate}" rerender="frequentRereshPanel, tableOutputpanel" oncomplete="AddTextareaEditorButton();" >
        <apex:param assignTo="{!selectOption}" name="option" value=""/>
    </apex:actionFunction>
    <apex:actionFunction name="calculateDueDateRTF" action="{!calculateDueDateRTF}" rerender="messagePanel,frequentRereshPanel, dueDatePanel" >
        <apex:param assignTo="{!selectOption}" name="option" value=""/>
    </apex:actionFunction>
    <apex:actionFunction action="{!saveRecord}" name="save" rerender="messagePanel, dueDatePanel" oncomplete="stopWaitMsgBar();displayMessage();headerSpaceHandler();">
     <apex:param assignTo="{!queueName}" name="strQueueName" value=""/>
     <apex:param assignTo="{!lastModifiedByLocking}" name="lastModifiedByLocking" value=""/>
     </apex:actionFunction>
      <apex:actionFunction action="{!saveRecordWR}" name="saveWithRerender" rerender="messagePanel, frequentRereshPanel, dueDatePanel, genericPanel,renderPanel,tableOutputpanel" oncomplete="fillStaticValueAfterError();stopWaitMsgBar();displayMessage();AddTextareaEditorButton(); if (saveSuccessful != null) window.parent.lockRecordAfterSave();headerSpaceHandler();">
     <apex:param assignTo="{!queueName}" name="strQueueName" value=""/>
     <apex:param assignTo="{!lastModifiedByLocking}" name="lastModifiedByLocking" value=""/>
     </apex:actionFunction>
	<apex:actionFunction name="AssignAttRefGeneratorId" rerender="messagePanel" immediate="true">
     	<apex:param assignTo="{!attRefGeneratorId}" name="attRefGeneratorId" value=""/> 
     </apex:actionFunction>
     <script>
	  window.parent.initialRecordState = '{!initialRecordState}';
	  var lastModifiedByLocking = '{!JSENCODE(lastModifiedByLocking)}';
	  var saveSuccessful = '';
     	var urgencyLookupId = '';
	  	var impactLookupId = '';
	  	var statusLookupId = '';
	  	var categoryName = '';
      	var categoryLookupId = '';
		var NONPRINT = '¬';
		var PE = 'П';
		var orgNamespace = 'BMCServiceDesk__';
		var lookupFilterIDMap = {};
		var readOnlyFieldMap = {};
		var filterFieldsMap= {};
		var filterStr = {!filterAPIStr};
		var fieldApiName;
		
		var refType = 'reference';
      	var noRefType = '';
      	var typeAheadDivId = 'autocompleteDiv';
      	var currentConsole = 'Problem';
		var pageSectionIdMap = {};
		var mandatoryFields = {};
		var AssignmentDetailSection = '{!JSINHTMLENCODE($Label.Console_Assignment)}';
        var isAssignmentDetailSectionPresent = false;
        var Error = '{!JSENCODE($Label.Error)}';
		var ClientFieldName = '';
        var lblClear = '{!JSENCODE($Label.Clear)}';
        var customStaffApi = 'FKStaff__c';
		var impactHelpText = '{!JSENCODE(impactTooltip)}';
		var urgencyHelpText = '{!JSENCODE(urgencyTooltip)}';
		var statusHelpText = '{!JSENCODE(statusTooltip)}';        
		var firstElement = '';    
	    var tagname = '';	   
	    var userTypeReference = '';
        var membersOf= '{!JSENCODE($Label.Members_of)}'; 
        function setFSFieldDetail(fieldAPIName, fieldLabel, ftype, fsRequired, fsDBRequired, fsName, fieldId, fieldHelpText,fieldUserLookup, fieldUpdateableFlag) {
	        var objtitleval = document.getElementById(fieldId);
	        if (objtitleval) {
	            var fieldValue = objtitleval.value;
				if(objtitleval != null && objtitleval != 'undefined') objtitleval.title = fieldHelpText;
				
				if(lookupFilterIDMap[fieldAPIName]==null){
					lookupFilterIDMap[fieldAPIName] = fieldId;
				}
				if(fieldUpdateableFlag == false) {
					if(readOnlyFieldMap[fieldId]==null){
						var elemVal ;
						if(ftype == 'textarea')
							elemVal = document.getElementById(fieldId).value;
						else if(ftype == 'string')
							elemVal = RemedyForceHTMLProcessor.getText(document.getElementById(fieldId));
							
                    	readOnlyFieldMap[fieldId] =elemVal; 
					}
				}
			}
			if (fsRequired || fsDBRequired) { 
				if (fieldAPIName.indexOf('FKImpact__c') > 0) 
					mandatoryFields['impactSelectId'] = fieldLabel + NONPRINT + fieldValue;
				else if (fieldAPIName.indexOf('FKUrgency__c') > 0) 
					mandatoryFields['urgencySelectId'] = fieldLabel + NONPRINT + fieldValue;
				else if (fieldAPIName.indexOf('FKStatus__c') > 0) 
					mandatoryFields['statusSelectId'] = fieldLabel + NONPRINT + fieldValue;
				else
					mandatoryFields[fieldId] = fieldLabel + NONPRINT + fieldValue;
			}
			
              
            tagname = objtitleval.tagName;
			if (firstElement == '' && tagname.toUpperCase() != 'SPAN') {
				if(fieldAPIName.toUpperCase() == (orgNamespace+'FKImpact__c').toUpperCase()){
					firstElement = 'impactSelectId';
				}else if( fieldAPIName.toUpperCase() == (orgNamespace+'FKUrgency__c').toUpperCase()){
					firstElement = 'urgencySelectId';
				}else if(fieldAPIName.toUpperCase() == (orgNamespace+'FKStatus__c').toUpperCase()){
					firstElement = 'statusSelectId';
				}
				else{
					firstElement = fieldId;
				}
			}
     }
		
     </script>
     	       <apex:outputPanel id="tableOutputpanel" layout="block" style="overflow:none;height:100%;width:100%">  
                  <apex:outputPanel id="messagePanel" styleClass="messageContainer">            
                    <apex:pageMessages id="pageMessage" />             
                    <div id="jsscripterrorId" class="message errorM3" style="display:none">
						<table class="messageTable" cellspacing="0" cellpadding="0" border="0" style="padding: 0px; margin: 0px;">
							<tr valign="top">
								<td>
									<img class="msgIcon" title="{!JSENCODE($Label.Error)}" src="/s.gif" alt="{!JSENCODE($Label.Error)}" />
								</td>
								<td>
									<div id="errorDescId"  class="messageText"></div>
								</td>
							</tr>
						</table>
					</div> 
					<!-- Success Message -->
					<div id="jsscriptsucessmsg"  style="display:none">
					 <apex:pageMessage summary="{!$Label.BMCServiceDesk__ApprovalSuccessMsg}" severity="confirm" strength="3"/> 
					 </div> 
					 <div id="SaveMessageDiv" class="msgCls message" style="display:none">
						<table class="messageTable" cellspacing="0" cellpadding="0" border="0" style="padding: 0px; margin: 4px 2px 4px 2px;">
							<tr valign="top">
								<td>
									<apex:image styleClass="SaveSuccessIcon" title="{!$Label.BMCServiceDesk__SavedSuccessfully}" value="/s.gif" alt="{!$Label.BMCServiceDesk__SavedSuccessfully}" />
								</td>
								<td>
									<div id="SaveMessage"  style="margin-left: 6px;"><apex:outputText value="{!$Label.BMCServiceDesk__SavedSuccessfully}" /></div>
								</td>
							</tr>
						</table>
					</div>					
                    <script> 
                    	window.scroll(0,0);
                    </script>          
                </apex:outputPanel>
                <div id='autocompleteDiv' class="clsAutocompleteDiv">
                     <select id="selectAutoOptions" class="clsAutocompleteSelectOption" onmousedown="isAutocomplete = true;"  onclick="SelectAutoValue(this,'autocompleteDiv');" multiple="multiple"  >
                     </select>
                 </div>
                  <apex:pageBlock id="thePAgeBlock" title="" >
                          <table style="overflow:none;height:100%;width:100%" cellspacing="0" cellpadding="0">
                          	   <tr>
                       	   		<td><div id="messageSpace" class="message_space_on"></div></td>
                                  <apex:facet name="header">   
                                   	<div id="topmenu" align="center" style="height:auto;width:100%;padding-bottom:5px;"></div>
                                  </apex:facet>   
                                </tr> 
                                 <tr>
                                    <td >
                                        <div   style="width:100%; overflow: auto;">
                                            <apex:repeat value="{!lstOfFSWrapper}" var="fsWrapper"> 
                                             <div id="div{!$Component.pageSectionId}" style="height:0px; position:relative; top:-30px">
                                            	<script>
                                                   pageSectionIdMap['{!JSINHTMLENCODE(fsWrapper.fsLabel)}'] = '{!$Component.pageSectionId}';
                                                </script>
                                             </div>
                                              <apex:pageBlockSection id="pageSectionId" title="{!fsWrapper.fsLabel}" columns="{!columnSize}">
                                                  <apex:repeat value="{!fsWrapper.lstOfFSMember}" var="f">
                                                      <apex:pageblockSectionItem rendered="{!$ObjectType.BMCServiceDesk__Problem__c.fields[f.fieldPath].Accessible}">  
                                                        <apex:outputLabel value="{!f.label}" rendered="{!NOT(CONTAINS(f.Label,'<BLANK>'))}"/>
                                                                <apex:outputPanel rendered="{!NOT(CONTAINS(f.Label,'<BLANK>'))}">
                                                                        <table id="tableId{!f.type}"  cellspacing="0" cellpadding="0">
                                                                            <tr>
                                                                                <td>
                                                                                    <apex:outputPanel styleClass="editable{!$ObjectType.BMCServiceDesk__Problem__c.fields[f.fieldPath].updateable}">
                                                                                        <apex:inputField id="inputField" value="{!problem[f.fieldPath]}" styleClass="{!If(f.type == 'reference', 'RFlookupClass', '')}" required="{!OR(f.required, f.DBRequired)}" onkeyup="setFieldAPIName('{!f.fieldPath}');" onclick="setFieldAPIName('{!f.fieldPath}');" onblur="{!IF(OR(f.required, f.DBRequired, f.type=='reference'), IF(f.type=='reference', 'disableDiv(typeAheadDivId, refType, this)', 'disableDiv(typeAheadDivId, noRefType, this)'), '')}"/>
                                                                                        <script>
                                                                                            setFSFieldDetail('{!f.fieldPath}', '{!JSENCODE(f.Label)}','{!JSENCODE(f.type)}', {!f.required}, {!f.DBRequired}, '{!JSENCODE(fsWrapper.fsName)}', '{!$Component.inputField}', '{!JSENCODE($ObjectType.Problem__c.fields[f.fieldPath].inlineHelpText)}', '{!$ObjectType.Problem__c.fields[f.fieldPath].ReferenceTo}', {!$ObjectType.Problem__c.fields[f.fieldPath].updateable});
                                                                                        </script>
                                                                                    </apex:outputPanel>                                     
                                                                                </td>
                                                                            </tr> 
                                                                        </table> 
                                                                </apex:outputPanel>
                                                      </apex:pageblockSectionItem>   
                                                  </apex:repeat>
                                             </apex:pageBlockSection>
                                            </apex:repeat>
                                            <div id="section2" style="display: none">
                                             <apex:pageBlockSection id="sec6" title="{!JSENCODE($Label.BMCServiceDesk__Console_Assignment)}" columns="{!columnSize}" > 
	                                              <apex:pageBlockSectionItem id="pageblock6Item1" >
                                                          <apex:outputLabel value="{!if((enableQueueAndUserAssignment),JSENCODE($Label.BMCServiceDesk__Queue),JSENCODE($Label.BMCServiceDesk__ConsoleOwner))}" />
	                                                          <apex:outputPanel >
	                                                                <table cellspacing="0" cellpadding="0">
	                                                                    <tr>
	                                                                        <td>
																				<apex:outputPanel rendered="{!NOT(enableQueueAndUserAssignment)}">
																					<input type="text" value="{!ownerName}" 
                                                                                    title = "{!$ObjectType.Problem__c.fields.ownerid.inlineHelpText}" id="owner_Name"  readonly="readonly" disabled="disabled"/>
																				</apex:outputPanel>		
																				<apex:outputPanel rendered="{!enableQueueAndUserAssignment}">
																					<input type="text" value="{!queueName}"  
																					title = "{!$ObjectType.Problem__c.fields.ownerid.inlineHelpText}" id="owner_Name" class="RFlookupClass" onclick="setFieldAPIName('Owner');"/>
																				</apex:outputPanel>
                                                                               
	                                                                        </td>
	                                                                        <td >
                                                                                <apex:outputPanel rendered="{!NOT(enableQueueAndUserAssignment)}">  
	                                                                            <img class="closeIconDis" src="/s.gif" title="{!$Label.Clear}" alt="Clear" onclick="resetQueueText();return false;" 
	                                                                        		onmouseout="this.className='closeIconDis'"  onmouseover="this.className='closeIconEnable'; " style="cursor: pointer;"/>
                                                                                </apex:outputPanel>
                                                                                <a href="#" style="text-decoration: none;" onclick="setFieldAPIName('ownerid');openOwnerLookupPopUP(enableQueueAndUserAssignment?'QUEUE':'OWNER','','', 'Problem__c', problemId);return false;"><img class="lookupIcon" title="{!if((enableQueueAndUserAssignment),JSENCODE($Label.Queue),$ObjectType.Problem__c.fields.ownerid.label)} {!JSENCODE($Label.tooltipForLookup)}" 
	                                                                                onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
                                                                                    onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" 
                                                                                    onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!if((enableQueueAndUserAssignment),JSENCODE($Label.Queue),$ObjectType.Problem__c.fields.FKStaff__c.label)} {!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" style="cursor: pointer;" /></a>
	                                                                          </td>
	                                                                    </tr>
	                                                                </table> 
	                                                            </apex:outputPanel>
	                                                    </apex:pageBlockSectionItem>    
	                                                    <apex:pageBlockSectionItem id="pageblock6Item2" rendered="{!enableQueueAndUserAssignment}">
	                                                         <apex:outputLabel value="{!JSENCODE($Label.BMCServiceDesk__IncidentsStaff)}" />
	                                                          <apex:outputPanel >
	                                                                <table cellspacing="0" cellpadding="0">
	                                                                    <tr>
	                                                                        <td> 
	                                                                            <apex:inputText id="staffId" value="{!staffName}"
	                                                                            	title="{!$ObjectType.BMCServiceDesk__Problem__c.fields.BMCServiceDesk__FKStaff__c.inlineHelpText}" styleClass="RFlookupClass" onclick="setFieldAPIName('BMCServiceDesk__FKStaff__c')"/>
	                                                                        </td>
	                                                                        <td >
                                                                                <apex:outputPanel rendered="{!NOT(enableQueueAndUserAssignment)}">  
                                                                                <img class="closeIconDis" src="/s.gif" title="{!JSENCODE($Label.Clear)}" alt="Clear" onclick="resetStaffText();return false;" 
	                                                                        		onmouseout="this.className='closeIconDis'"  onmouseover="this.className='{!IF(enableQueueAndUserAssignment == true,'closeIconEnable','closeIconDis')}'" style="cursor: pointer;"/>
                                                                                </apex:outputPanel>
	                                                                            <a href="#" style="text-decoration: none;" onclick="setFieldAPIName('FKStaff__c');openOwnerLookupPopUP('STAFF',queueId,'',  'Problem__c', problemId);return false;" ><img class="lookupIcon" title="{!$ObjectType.Problem__c.fields.FKStaff__c.label} {!JSENCODE($Label.tooltipForLookup)}" 
	                                                                                onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
                                                                                    onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" 
	                                                                                onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!$ObjectType.Problem__c.fields.FKStaff__c.label} {!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" style="cursor: pointer;" /></a>
	                                                                          </td>
	                                                                    </tr>
	                                                                </table> 
	                                                            </apex:outputPanel>
	                                                    </apex:pageBlockSectionItem>                                
	                                         </apex:pageBlockSection>
										 </div>
                                         </div>
                                    </td>
                                </tr>
                          </table>  
						   <apex:facet name="footer">
						<table style="border: 1;" align="Center"  cellspacing="0" cellpadding="0">
							<tr>
                                <td align="center"><span><a class="backtotop" href="#" onClick="if(parent.isServiceCloudConsole == 'true') {parent.scrollTo(0,0);}">{!$Label.Console_BackToTop}</a> </span> 
								<span id="links" style="display: {!IF(problem.Id == '', 'none', 'inline')}">
								<span class="separator"> | </span> 
								<span><a class="backtotop" id="RelatedListlink" href="javascript:void(0)" onClick="window.parent.ProblemRelatedListBtnhandler();">{!$Label.RelatedLists}</a></span>
								 </span> 
								</td>
							</tr>
						</table>
					</apex:facet>
                    </apex:pageBlock>
					<apex:inputHidden value="{!problem.BMCServiceDesk__FKUrgency__c}" id="urgency__id"/>
                    <apex:inputHidden value="{!problem.BMCServiceDesk__FKImpact__c}" id="impact__id"/>
                    <apex:inputHidden value="{!problem.BMCServiceDesk__FKStatus__c}" id="status__id"/>
                                                                                                     
                    <apex:inputHidden value="{!problem.BMCServiceDesk__FKStaff__c}" id="ownerOpenby_Id"/>
                    <apex:inputHidden value="{!problem.ownerid}" id="owner_Id"/>
                    <apex:inputHidden value="{!queueId}" id="queueId"/>
                    
                    <script> 
                        urgencyLookupId = '{!$Component.urgency__id}';
                        impactLookupId = '{!$Component.impact__id}';
                        statusLookupId = '{!$Component.status__id}';
                        ownerOpenby_Id = '{!$Component.ownerOpenby_Id}';
                        owner_Id = '{!$Component.owner_Id}';
                        queue_Id = '{!$Component.queueId}';
                        
						var urgancyvalue='{!problem.BMCServiceDesk__FKUrgency__c}';
                        var impactvalue='{!problem.BMCServiceDesk__FKImpact__c}';
                        var statusvalue='{!problem.BMCServiceDesk__FKStatus__c}';

                        var staffName = '{!JSENCODE(staffName)}';
                        var ownerName = '{!JSENCODE(ownerName)}';
                        var queueName = '{!JSENCODE(queueName)}';
                        var queueId = '{!JSENCODE(queueId)}';
                        var staffIdValue = '{!staffId}';
                        var  ownerOpenById = ownerOpenby_Id;
						var  staffId = '{!$Component.thpage:theForm:thePAgeBlock:sec6.pageblock6Item2.staffId}';
						var strQueueId = '{!$Component.queueId}';
						var  ownerId = owner_Id;
                        document.getElementById(ownerOpenById).value = '{!problem.BMCServiceDesk__FKStaff__c}';
                        document.getElementById(ownerId).value = '{!problem.ownerid}'; 
                    </script>
                </apex:outputPanel>
    </apex:form>
    <script>
    	var errorComponentID = '{!$Component.thpage:theForm:pageMessage}';
    	var prefixMap;
        if(window.parent.isRFConsoleDetailForm =='true'){
            prefixMap = window.parent.parent.ObjectPrefixMap;
        }else{
            prefixMap = window.parent.ObjectPrefixMap;
        }
        prefixMap.push(new Array('005','User'));
        prefixMap.push(new Array('00G','Group'));
        
    	var selectClientId=0; 
    	var isAutocomplete = false;
        var saveSuccess = '{!JSENCODE($Label.SavedSuccessfully)}';
        var searchErrorMsg = '{!JSENCODE($Label.GsErrorMsg)}';
        var OverwriteWarning = '{!JSENCODE($Label.OverwriteWarning)}';
        var ProblemIsClosed = '{!JSENCODE($Label.problemclosed)}';
        
        var enableQueueAndUserAssignment = {!enableQueueAndUserAssignment};
        var ownerType ='';
        var isRTFEnabled = true; 
        var columnSize = {!columnSize};
        var problemId = '{!JSENCODE(problem.Id)}';
		var oldProblemId = '{!JSENCODE(oldProblemId)}';
        var mandatoryFieldValueValidationMsg = '{!JSENCODE($Label.mandatoryFieldValueValidationMsg)}';
        var status = '{!problem.state__c}';
        _RemotingActions={}
        _RemotingActions.fetchAutoSelectData= '{!$RemoteAction.ConsoleRemoteActions.fetchAutoSelectData}';
        _RemotingActions.getLookUpData = '{!$RemoteAction.ConsoleRemoteActions.getData}';
       
        var setProblemData ;
    	var saveProblem = function doSave(){ 
    		var errorMsges = validateData();
    		if (errorMsges!='') {
    			document.getElementById('messageSpace').className='message_space_off';
    			return showPageMsg(errorMsges);
			}
			document.getElementById('messageSpace').className='message_space_on';  
        	var strQueueName = '';
        	if (document.getElementById(getHTMLInputID('OwnerId'))) 
                strQueueName = document.getElementById(getHTMLInputID('OwnerId')).value;
            else if (document.getElementById('owner_Name'))
                strQueueName = document.getElementById('owner_Name').value;         
             
        	startWaitMsgBar();
        	isRTFEnabled =window.parent.RTFEnabledPage();
        	if (isRTFEnabled) 
        		saveSuccessful = save(strQueueName, window.parent.lastModifiedByLocking);
        	else{
        		retainStaticFieldValueBeforeSave();
        		saveSuccessful = saveWithRerender(strQueueName, window.parent.lastModifiedByLocking);
        	}	
        }
     
      if(window.parent.saveProblem!=undefined){
            window.parent.saveProblem(saveProblem);
        }
      
    </script>
	   <apex:outputPanel id="renderPanel">             
        <script>         
           status = '{!problem.state__c}';
           problemId = '{!JSENCODE(problem.Id)}';
		   oldProblemId = '{!JSENCODE(oldProblemId)}';
			var queueId = '{!JSENCODE(queueId)}';
           setProblemData = function setProblemData(){
           
	            var arr = new Array();
				arr['Id'] = '{!JSENCODE(problem.Id)}';
	            arr['Name'] = '{!JSENCODE(problem.Name)}';
	           	arr[ 'Stage__c' ] = getTranslatedStage();
	            arr[ 'state__c' ] =  '{!problem.state__c}';
	            arr[ 'id' ] =  '{!problem.id}';
	            arr[ 'ServiceTargetStatus' ]='{!JSENCODE(ServiceTargetStatus)}';
                arr[ 'Problem_Description__c' ] =  '{!JSENCODE(problem.Problem_Description__c)}';
                arr[ 'isRecordLock' ] = '{!JSENCODE(isRecordLock)}'; 
	            return arr;
            
        	};
        if(window.parent.setProblemData!=undefined){
            window.parent.setProblemData(setProblemData);
        } 
        
         function getTranslatedStage(){  
         	
         	if('{!JSENCODE(problem.FKStatus__r.Stage__c)}' =='Opened'){
	            return '{!JSENCODE($Label.Opened)}';
            }else if('{!JSENCODE(problem.FKStatus__r.Stage__c)}' =='Acknowledged'){
            	return '{!JSENCODE($Label.StageProgression_Acknowledged)}';
            }else if('{!JSENCODE(problem.FKStatus__r.Stage__c)}' =='In Process'){
            	return '{!JSENCODE($Label.StageProgression_InProcess)}';
            }else if('{!JSENCODE(problem.FKStatus__r.Stage__c)}' =='Closed'){
            	return '{!JSENCODE($Label.Closed)}';
            }else{
            	return '{!JSENCODE(problem.FKStatus__r.Stage__c)}';
            }
         }
		
		
        </script>   
        </apex:outputPanel>    
    <apex:outputPanel id="genericPanel">             
        <script>         
           var messageStr  = '{!JSENCODE(messageString)}';
          
           function displayMessage(){
            	if(!isRTFEnabled && messageStr!=null && messageStr !=''){
            		if(messageStr == saveSuccess){
            			window.parent.afterSaveSucceed();  
						handleElemEvent();	
            			ShowInlineSaveMessage();
				    	showDueDatePopup(); 
            		}else{
            			alert(messageStr);
            		}
            	} else if(messageStr ==null || messageStr == '') {
            		var clickedOnceTemp = window.parent.clickedOnce ;
            		handleElemEvent();
            		window.parent.clickedOnce = clickedOnceTemp ;
            	}
            }
             
        </script>   
        </apex:outputPanel>  
    
	<apex:outputPanel id="dueDatePanel">
		<script>
			var showPopUp = '{!showDueDatePopUp}';
			window.parent.isDeleted = false;
		if ({!isDeleted}) {
			window.parent.isDeleted = true;
		}		
		</script>
	</apex:outputPanel>	
	
	<script type="text/javascript" src="{!$Resource.SDEFCommonJS}/HTML_ENCODE_DECODE.js"></script>
    <script src="{!$Resource.SDEFCommonJS}/ConsoleProblemDetail.js"  type="text/javascript" />
    <script src="{!$Resource.SDEFCommonJS}/TypeAhead.js"  type="text/javascript" />
	<script src="{!$Resource.SDEFCommonJS}/ConsoleDetail.js"  type="text/javascript" />
    <apex:outputPanel id="frequentRereshPanel">
        <script>    
            createUrgencyPickList('{!$ObjectType.Problem__c.fields.FKUrgency__c.Updateable}');
            createImpactPickList('{!$ObjectType.Problem__c.fields.FKImpact__c.Updateable}');
            createStatusPickList('Problem', '{!$ObjectType.Problem__c.fields.FKStatus__c.Updateable}');  
            userTypeReference ='{!JSENCODE(userTypeReference)}';
            if(userTypeReference !=null && userTypeReference != 'undefined' && userTypeReference!='')
            	hideUserTypeSelector(userTypeReference);   
            createSectionLinks();
			adjustFSLinkDiv();
			setTypeAheadForLookups();
			createStandardOwnerField('Problem__c', problemId);
			createStandardStaffField('Problem__c', problemId);
        </script>
    </apex:outputPanel>
    <script>
		handleElemEvent();
		createFilterFieldMap();
		if(firstElement != null && firstElement != '')
			document.getElementById(firstElement).focus();
		
		if(document.addEventListener){
            document.addEventListener("click", function(){
                if(isAutocomplete != 'undefined' && isAutocomplete != undefined && isAutocomplete){
                    disableAutoDiv();
                }
            });
        }else if(document.attachEvent){
            document.attachEvent("onclick", function(){
                if(isAutocomplete != 'undefined' && isAutocomplete != undefined && isAutocomplete){
                    disableAutoDiv();
                }
            });
        }
    </script>
  </body>
</apex:page>