<apex:page id="contactForSendPibPage" standardController="Task" extensions="SelectContactForSendPibCtrl" ShowHeader="false" sidebar="false" tabStyle="Contact">
<apex:includeScript value="{!URLFOR($Resource.HomePageResource  , 'js/jquery.min.js')}"/>
<style>
	.contactHeaderClass{
		text-align: center;
	}
</style>
<script>
function checkAll(thisObj){
	$(".checkBox").each(function( index, element ) {
		if($(thisObj).is(":checked")){
			$(element).attr('checked', true);
		}else{
			$(element).attr('checked', false);
		}
    });
}

function sendEmailToContact(){
	var contactIds = '';
	$(".checkBox").each(function( index, element ) {
		if($(element).is(":checked")){
			contactIds += $(element).attr('id') + ',';
		}
    });
    if(contactIds == ''){
    	alert("Please select atleast one contact");
    }else{
    	sendEmail(contactIds);
    }
}

</script>
<apex:form >
	<apex:actionstatus id="status">
		<apex:facet name="start">
			<div class="waitingSearchDiv" style="background-color: #fbfbfb; height: 100%; opacity: 0.65; width: 100%;">
				<div class="waitingHolder" style="top: 74.2px; width: 91px;">
					<img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />
					<span class="waitingDescription">Please Wait...</span>
				</div>
			</div>
		</apex:facet>
	</apex:actionstatus>

	<apex:actionFunction name="sendEmail" action="{!sendEmail}" rerender="pgMsg" status="status">
		<apex:param name="firstParam" value="" assignTo="{!contactIds}"/>
	</apex:actionFunction>
	<apex:pageMessages id="pgMsg" />
	<apex:pageBlock title="Contacts" id="contactsPblock" rendered="{!contacts.size > 0}">
		<apex:outputPanel id="contactListPanel">
			<apex:pageBlockTable value="{!contacts}" var="contact" id="contactsPblockTable" columnClasses="contactHeaderClass" headerClass="contactHeaderClass">
				<apex:column id="selectCol">
					<apex:facet name="header"><input type="checkbox" class="headerCheckBox" onclick="checkAll(this);"/></apex:facet>
					<input type="checkbox" id="{!contact.Id}" class="checkBox"/>
				</apex:column>
				<apex:column id="nameCol" value="{!contact.Name}"/>
				<apex:column id="emailCol" value="{!contact.Email}"/>
			</apex:pageBlockTable>
			<div style="text-align: center;">
				<br/>
				<input type="button" class="btn" value="Send" onclick="sendEmailToContact();"/>
				<input type="button" class="btn" value="Close" onclick="window.close();"/>
			</div>
		</apex:outputPanel>
	</apex:pageBlock>
</apex:form>
</apex:page>