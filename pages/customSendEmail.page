<apex:page controller="customSendEmailController" language="{!$CurrentPage.parameters.lang}" cache="false" >

<script>
        if ('{!$CurrentPage.parameters.lang}'=='') {
        	window.location = '{!$CurrentPage.URL}&lang={!language}';
        }
    	
</script>
<apex:form rendered="{!$CurrentPage.parameters.lang!=''}">    
    <apex:pageMessages ></apex:pageMessages>    
    <a href='/{!ObjectId}'>Return to Quote</a> <br/>
    
    <apex:pageBlock title="Include Quote Attachments">        
        <apex:pageBlockTable var="a" value="{!quoteAttachments}" columns="6" rowClasses="odd,even" styleClass="tableClass">
		<apex:column >
			<apex:facet name="header"><apex:inputCheckbox onclick="checkAll(this,'checkedquote')" value="{!qattachdefault}">&nbsp;</apex:inputCheckbox></apex:facet>
				<!-- <a href="/servlet/servlet.FileDownload?file={!a.file.id}" class="actionLink" target="_blank" title="download - {!a.file.name}">Download</a> -->
            	<apex:inputCheckbox value="{!a.selected}" id="checkedquote"></apex:inputCheckbox>
		</apex:column>		
		<apex:column >
		<apex:facet name="header">File name</apex:facet>
			<apex:outputText >{!a.file.name}</apex:outputText>
        </apex:column>
		<apex:column >
			<apex:facet name="header">Description</apex:facet>
			<apex:outputText >{!a.file.description}</apex:outputText>
		</apex:column>        
		<apex:column >
		<apex:facet name="header">Size</apex:facet>
			<apex:outputText value="{0, number,###,###,##0}">
 				<apex:param value="{!a.file.BodyLength/1024}" />
			</apex:outputText>&nbsp;KB
		</apex:column>
		<apex:column >
		<apex:facet name="header">Last Modified</apex:facet>
			<apex:outputText >{!a.file.LastModifiedDate}</apex:outputText>
		</apex:column>
		<apex:column >
			<apex:facet name="header">Created</apex:facet>
			<apex:outputText >{!a.file.CreatedDate}</apex:outputText>
		</apex:column>
	</apex:pageBlockTable>        
    </apex:pageBlock>
    
    <apex:pageBlock title="Email Quote">
        	<apex:pageBlockButtons >
                <apex:commandButton value="Send Email" action="{!send}"/>
                <apex:commandButton value="Cancel" action="{!back}"/>
        	</apex:pageBlockButtons>
        	<apex:pageBlockSection title="Email" columns="1">
            <!--            	
        	<apex:inputField id="To" value="{!quote.ContactId}" label="To" />
			-->
            <apex:selectList multiselect="false" label="Send From" id="fromEmailAddress" size="1" style="width:400px" value="{!fromEmail}">
            	<apex:selectOptions value="{!orgWideAddresses}"/>
        	</apex:selectList>
			
            <apex:selectList multiselect="false" label="Reply To" id="replyEmailAddress" size="1" style="width:400px" value="{!replyToEmailAddr}">
            	<apex:selectOptions value="{!replyToEmail}"/>
        	</apex:selectList>    
            
            <apex:inputText id="contact" value="{!quote.Contact_Email__c}" Label="To (selected contact)" style="width:400px" disabled="true" required="true"	 />
        	                	
        	<apex:inputText id="to" value="{!to}" Label="Additional To" style="width:400px" />

        	<apex:inputText id="cc" value="{!cc}" label="cc" style="width:400px" />
        	                    
            <apex:inputText value="{!subject}" id="Subject" maxlength="80" label="Subject" style="width:400px" required="true" />
                     
            <apex:inputTextarea value="{!body}" id="Body" rows="10" label="Body" required="true" richText="true"/>			
            <br/><br/>
			</apex:pageBlockSection>
            

        
    </apex:pageBlock>
    
    <apex:pageBlock title="Include Opportunity Attachments">        
        <apex:pageBlockTable var="a" value="{!otherAttachments}" columns="6" rowClasses="odd,even" styleClass="tableClass">
		<apex:column >
			<apex:facet name="header"><apex:inputCheckbox onclick="checkAll(this,'checkedoppty')">&nbsp;</apex:inputCheckbox></apex:facet>
				<!-- <a href="/servlet/servlet.FileDownload?file={!a.file.id}" class="actionLink" target="_blank" title="download - {!a.file.name}">Download</a> -->
            	<apex:inputCheckbox value="{!a.selected}" id="checkedoppty"></apex:inputCheckbox>
		</apex:column>		
		<apex:column >
		<apex:facet name="header">File name</apex:facet>
			<apex:outputText >{!a.file.name}</apex:outputText>
        </apex:column>
		<apex:column >
			<apex:facet name="header">Description</apex:facet>
			<apex:outputText >{!a.file.description}</apex:outputText>
		</apex:column>        
		<apex:column >
		<apex:facet name="header">Size</apex:facet>
			<apex:outputText value="{0, number,###,###,##0}">
 				<apex:param value="{!a.file.BodyLength/1024}" />
			</apex:outputText>&nbsp;KB
		</apex:column>
		<apex:column >
		<apex:facet name="header">Last Modified</apex:facet>
			<apex:outputText >{!a.file.LastModifiedDate}</apex:outputText>
		</apex:column>
		<apex:column >
			<apex:facet name="header">Created</apex:facet>
			<apex:outputText >{!a.file.CreatedDate}</apex:outputText>
		</apex:column>
	</apex:pageBlockTable>
		
    </apex:pageBlock>
    <apex:outputText >using template email template {!emailtemplate} and language {!language}</apex:outputText>
    </apex:form>
    
    <script>
        function checkAll(cb, searchstring)
        {
			var inputElem = document.getElementsByTagName("input");
			for(var i=0; i<inputElem.length; i++)
            {
                if(inputElem[i].id.indexOf(searchstring)!=-1)
                	inputElem[i].checked = cb.checked;
            }
        }
    	
    </script>
</apex:page>