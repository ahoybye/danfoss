<apex:page id="thpage" standardController="BMCServiceDesk__Broadcasts__c"
    extensions="BMCServiceDesk.ConsoleBroadcastDetailController,BMCServiceDesk.ConsoleRemoteActions"
    standardStylesheets="true" showHeader="false" sidebar="false">
    <head>
        <link rel="stylesheet" href="{!$Resource.SDEFStyles}/ConsoleDetail.css"
            type="text/css" />
    </head>

    <body onload="doOnLoadActivity()">
        <apex:form id="theForm" onclick="parent.hideMenu();">
            <apex:actionFunction action="{!saveRecord}" name="save" rerender="messagePanel" oncomplete="stopWaitMsgBar();displayMessage();headerSpaceHandler();">
            	<apex:param assignTo="{!csvAccountID}" name="csvAccountListparam" value=""/>
            	<apex:param assignTo="{!attRefGeneratorId}" name="attRefGeneratorId" value=""/>
                <apex:param assignTo="{!lastModifiedByLocking}" name="lastModifiedByLocking" value=""/>
		    </apex:actionFunction>
             <apex:actionFunction action="{!saveRecordWR}" name="saveWithRerender" rerender="messagePanel, renderPanel,tableOutputpanel,genericPanel,frequentRereshPanel" oncomplete="stopWaitMsgBar();displayMessage();AddTextareaEditorButton();if (saveSuccessful != null) window.parent.lockRecordAfterSave();headerSpaceHandler();">
			 	<apex:param assignTo="{!csvAccountID}" name="csvAccountListparam" value=""/>
         		<apex:param assignTo="{!attRefGeneratorId}" name="attRefGeneratorId" value=""/>
                <apex:param assignTo="{!lastModifiedByLocking}" name="lastModifiedByLocking" value=""/>
             </apex:actionFunction> 
			<apex:actionFunction name="AssignAttRefGeneratorId" rerender="messagePanel" immediate="true">
     		   <apex:param assignTo="{!attRefGeneratorId}" name="attRefGeneratorId" value=""/> 
     	    </apex:actionFunction>


            <script>
			 window.parent.initialRecordState = '{!initialRecordState}';
             var saveSuccessful = '';
             var lastModifiedByLocking = '{!JSENCODE(lastModifiedByLocking)}';
            	var errorComponentID = '{!$Component.thpage:theForm:pageMessage}';
                var ownerType ='';
                var orgNamespace = 'BMCServiceDesk__';
				var broadcastId = '{!JSENCODE(broadcast.Id)}';
                var BroadcastIsClosed = '{!JSENCODE($Label.BroadcastClosed)}';
                var userTypeReference = '';
                var lookupFilterIDMap = {};
                var filterFieldsMap= {};
                var pageSectionIdMap = {};
                var fieldApiName;
                var refType = 'reference';
                var noRefType = '';
                var typeAheadDivId = 'autocompleteDiv';
                var mandatoryFields = {};
                var NONPRINT = 'ï¿½';
                var Error = '{!JSENCODE($Label.Error)}';
                var customStaffApi = 'FKStaff__c';
                var currentConsole = 'Broadcast';
                var AssignmentDetailSection = '{!JSINHTMLENCODE($Label.Console_Assignment)}';
                var DisplayBroadcastSection = '{!JSINHTMLENCODE($Label.DisplayBroadcast)}';
                var impactHelpText = '{!JSENCODE(impactTooltip)}';
                var urgencyHelpText = '{!JSENCODE(urgencyTooltip)}';
                var statusHelpText = '{!JSENCODE(statusTooltip)}'; 
                var toEveryOneElId = '{!JSENCODE($Component.theForm:thePAgeBlock:sec6:eveyoneCheckbox)}';
                var profileNameElId = '{!JSENCODE($Component.theForm:thePAgeBlock:sec6:Proflie__c_id_name)}';
                var displayInSSElId = '{!JSENCODE($Component.thpage:theForm:thePAgeBlock:sec6:displayInSS)}';
                var broadcastState = {!broadcast.state__c};      
                var isCategoryMandatory = false;
                var isBroadcastMessageMandatory = false;    
                var isBroadcastIDMandatory = false;             
                var firstElement = '';    
            
			    var tagname = '';
                var membersOf= '{!JSENCODE($Label.Members_of)}';           
                function setFSFieldDetail(fieldAPIName, fieldLabel, fsRequired, fsDBRequired, fsName, fieldId, fieldHelpText,fieldUserLookup) {
                    var objtitleval = document.getElementById(fieldId);
                    if (objtitleval) {
                        var fieldValue = objtitleval.value;
                        if(objtitleval != null && objtitleval != 'undefined') objtitleval.title = fieldHelpText;
                        
                        if(lookupFilterIDMap[fieldAPIName]==null){
                            lookupFilterIDMap[fieldAPIName] = fieldId;
                        }
                        
                        if (fsRequired || fsDBRequired){
                            if (fieldAPIName.indexOf('FKImpact__c') > 0) 
                                mandatoryFields['impactSelectId'] = fieldLabel + NONPRINT + fieldValue;
                            else if (fieldAPIName.indexOf('FKUrgency__c') > 0) 
                                mandatoryFields['urgencySelectId'] = fieldLabel + NONPRINT + fieldValue;
                            else if (fieldAPIName.indexOf('FKStatus__c') > 0) 
                                mandatoryFields['statusSelectId'] = fieldLabel + NONPRINT + fieldValue;
                            else
                                mandatoryFields[fieldId] = fieldLabel + NONPRINT + fieldValue;
							if (fsName.toUpperCase()==('BMCServiceDesk__Console_BroadcastDetails').toUpperCase() && fieldAPIName.indexOf('FKCategory__c') > 0) {
								isCategoryMandatory = true;
								if(parent.Ext.isIE8 || parent.Ext.isIE7){
									objtitleval.style.marginRight="-4px"; 
								}
								mandatoryFields[fieldId] = fieldLabel + NONPRINT + fieldValue;
							}
						}

                        if (fsName.toUpperCase()==('BMCServiceDesk__Console_BroadcastDetails').toUpperCase() && fieldAPIName.indexOf('broadcastMessage__c') > 0) {
                            isBroadcastMessageMandatory = true;
                            if(parent.Ext.isIE8 || parent.Ext.isIE7){
                                objtitleval.style.marginRight="-4px"; 
                            }
							mandatoryFields[fieldId] = fieldLabel + NONPRINT + fieldValue;
                        }   

                        if (fieldAPIName=='Name') {
                            isBroadcastIDMandatory = true;
                            if(parent.Ext.isIE8 || parent.Ext.isIE7){
                                objtitleval.style.marginRight="-4px"; 
                            }
							mandatoryFields[fieldId] = fieldLabel + NONPRINT + fieldValue;
                        }                       
                    }                       
					 
                      
                    tagname = objtitleval.tagName;
					if (firstElement == '' && tagname.toUpperCase() != 'SPAN') {
						if(fieldAPIName.toUpperCase() == (orgNamespace+'FKImpact__c').toUpperCase()){
							firstElement = 'impactSelectId';
						}else if( fieldAPIName.toUpperCase() == (orgNamespace+'FKUrgency__c').toUpperCase()){
							firstElement = 'urgencySelectId';
						}else if(fieldAPIName.toUpperCase() == (orgNamespace+'FKStatus__c').toUpperCase()){
							firstElement = 'statusSelectId';
						}
						else{
							firstElement = fieldId;
						}
					} 
                }
            </script>
            <apex:outputPanel id="tableOutputpanel" layout="block"
                style="overflow:none;height:100%;width:100%">
                <apex:outputPanel id="messagePanel" styleClass="messageContainer">
                    <apex:pageMessages id="pageMessage" />
                    <div id="jsscripterrorId" class="message errorM3" style="display:none">
                        <table class="messageTable" cellspacing="0" cellpadding="0" border="0" style="padding: 0px; margin: 0px;">
                            <tr valign="top">
                                <td>
                                    <img class="msgIcon" title="{!JSENCODE($Label.Error)}" src="/s.gif" alt="{!JSENCODE($Label.Error)}" />
                                </td>
                                <td>
                                    <div id="errorDescId"  class="messageText"></div>
                                </td>
                            </tr>
                        </table>
                    </div>
					<!-- Success Message -->
					<div id="jsscriptsucessmsg"  style="display:none">
					 <apex:pageMessage summary="{!$Label.BMCServiceDesk__ApprovalSuccessMsg}" severity="confirm" strength="3"/> 
					 </div>
					 <div id="SaveMessageDiv" class="msgCls message" style="display:none">
						<table class="messageTable" cellspacing="0" cellpadding="0" border="0" style="padding: 0px; margin: 4px 2px 4px 2px;">
							<tr valign="top">
								<td>
									<apex:image styleClass="SaveSuccessIcon" title="{!$Label.BMCServiceDesk__SavedSuccessfully}" value="/s.gif" alt="{!$Label.BMCServiceDesk__SavedSuccessfully}" />
								</td>
								<td>
									<div id="SaveMessage"   style="margin-left: 6px;"><apex:outputText value="{!$Label.BMCServiceDesk__SavedSuccessfully}" /></div>
								</td>
							</tr>
						</table>
					</div>	 					
                    <script> 
                            window.scroll(0,0);
                    </script>
                </apex:outputPanel>
                <div id='autocompleteDiv' class="clsAutocompleteDiv">
                    <select id="selectAutoOptions" class="clsAutocompleteSelectOption"
                        onmousedown="isAutocomplete = true;"
                        onclick="SelectAutoValue(this,'autocompleteDiv');"
                        multiple="multiple">
                    </select>
                </div>
                <apex:pageBlock id="thePAgeBlock" title="">
                    <table style="overflow: none; height: 100%; width: 100%"
                        cellspacing="0" cellpadding="0">
                        <tr>
                        	<td><div id="messageSpace" class="message_space_on"></div></td>
                            <apex:facet name="header">
                                <div id="topmenu" align="center"
                                    style="height: auto; width: 100%; padding-bottom: 5px;"></div>
                            </apex:facet>
                        </tr>
                        <tr>
                            <td>
                                <div style="width: 100%; overflow: auto;">
                                    <apex:repeat value="{!lstOfFSWrapper}" var="fsWrapper">
                                        <div id="div{!$Component.pageSectionId}"
                                            style="height: 0px; position: relative; top: -30px">
                                                <script>
                                                    pageSectionIdMap['{!JSINHTMLENCODE(fsWrapper.fsLabel)}'] = '{!$Component.pageSectionId}';
                                                </script>  
                                        </div>
                                        <apex:pageBlockSection id="pageSectionId"
                                            title="{!fsWrapper.fsLabel}" columns="{!columnSize}">
                                            <apex:repeat value="{!fsWrapper.lstOfFSMember}" var="f">
                                                <apex:pageblockSectionItem rendered="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields[f.fieldPath].Accessible}">
                                                    <apex:outputLabel value="{!f.label}"
                                                        rendered="{!NOT(CONTAINS(f.Label,'<BLANK>'))}" />
                                                    <apex:outputPanel rendered="{!NOT(CONTAINS(f.Label,'<BLANK>'))}">
                                                        <table id="tableId{!f.type}" cellspacing="0"
                                                            cellpadding="0">
                                                            <tr>
                                                                <td>
                                                                <apex:outputPanel styleClass="editable{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields[f.fieldPath].updateable}">
                                                                        <apex:inputField id="inputField"
                                                                            value="{!broadcast[f.fieldPath]}"
                                                                            styleClass="{!If(f.type == 'reference', 'RFlookupClass', '')}"
                                                                            required="{!OR(f.required, f.DBRequired)}"
                                                                            onkeyup="setFieldAPIName('{!f.fieldPath}');"
                                                                            onclick="setFieldAPIName('{!f.fieldPath}');"
                                                                            onblur="{!IF(OR(f.required, f.DBRequired, f.type=='reference', CONTAINS(f.fieldPath,'broadcastMessage__c'),CONTAINS(f.fieldPath,'Name')), IF(f.type=='reference', 'disableDiv(typeAheadDivId, refType, this)', 'disableDiv(typeAheadDivId, noRefType, this)'), '')}"/>
                                                                        <script>
                                                                            setFSFieldDetail('{!f.fieldPath}', '{!JSENCODE(f.Label)}', {!f.required}, {!f.DBRequired}, '{!JSENCODE(fsWrapper.fsName)}', '{!$Component.inputField}', '{!JSENCODE($ObjectType.Broadcasts__c.fields[f.fieldPath].inlineHelpText)}', '{!$ObjectType.Broadcasts__c.fields[f.fieldPath].ReferenceTo}');
                                                                        </script>
                                                                    </apex:outputPanel></td>
                                                            </tr>
                                                        </table>
                                                    </apex:outputPanel>
                                                </apex:pageblockSectionItem>
                                            </apex:repeat>
                                        </apex:pageBlockSection>
                                    </apex:repeat>
                                    <div id="section2" style="display: none">
                                    <apex:pageBlockSection id="sec5" title="{!JSENCODE($Label.BMCServiceDesk__Console_Assignment)}" columns="{!columnSize}" > 
                                              <apex:pageBlockSectionItem id="pageblock5Item1" >
                                                          <apex:outputLabel value="{!if((enableQueueAndUserAssignment),JSENCODE($Label.BMCServiceDesk__Queue),JSENCODE($Label.BMCServiceDesk__ConsoleOwner))}" />
                                                          <apex:outputPanel >
                                                                <table cellspacing="0" cellpadding="0">
                                                                    <tr>
                                                                        <td>
																			<apex:outputPanel rendered="{!NOT(enableQueueAndUserAssignment)}">
																				<input type="text" value="{!ownerName}" 
                                                                                    title = "{!$ObjectType.Broadcasts__c.fields.ownerid.inlineHelpText}" id="owner_Name"  readonly="readonly" disabled="disabled"/>
																			</apex:outputPanel>		
                                                                            <apex:outputPanel rendered="{!enableQueueAndUserAssignment}">
                                                                                <input type="text" value="{!queueName}"  
                                                                                 title = "{!$ObjectType.Broadcasts__c.fields.ownerid.inlineHelpText}" id="owner_Name" class="RFlookupClass" onclick="setFieldAPIName('Owner');"/>
																			</apex:outputPanel>
                                                                            
                                                                        </td>
                                                                        <td >
                                                                            <apex:outputPanel rendered="{!NOT(enableQueueAndUserAssignment)}">  
                                                                            <img class="closeIconDis" src="/s.gif" title="{!$Label.Clear}" alt="Clear" onclick="resetQueueText();return false;" 
                                                                                onmouseout="this.className='closeIconDis'"  onmouseover="this.className='closeIconEnable'; " style="cursor: pointer;"/>
                                                                            </apex:outputPanel>   
                                                                                <a href="#" style="text-decoration: none;" onclick="setFieldAPIName('ownerid');openOwnerLookupPopUP(enableQueueAndUserAssignment?'QUEUE':'OWNER','','', 'Broadcasts__c', broadcastId);return false;"><img class="lookupIcon" title="{!if((enableQueueAndUserAssignment),JSENCODE($Label.Queue),$ObjectType.Broadcasts__c.fields.ownerid.label)} {!JSENCODE($Label.tooltipForLookup)}" 
                                                                                onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
                                                                                    onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" 
                                                                                    onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!if((enableQueueAndUserAssignment),JSENCODE($Label.Queue),$ObjectType.Broadcasts__c.fields.FKStaff__c.label)} {!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" style="cursor: pointer;" /></a>
                                                                          </td>
                                                                    </tr>
                                                                </table> 
                                                            </apex:outputPanel>
                                                    </apex:pageBlockSectionItem>    
                                                    <apex:pageBlockSectionItem id="pageblock5Item2" rendered="{!enableQueueAndUserAssignment}">
                                                         <apex:outputLabel value="{!JSENCODE($Label.BMCServiceDesk__IncidentsStaff)}" />
                                                          <apex:outputPanel >
                                                                <table cellspacing="0" cellpadding="0">
                                                                    <tr>
                                                                        <td> 
                                                                            <apex:inputText id="staffId" value="{!staffName}"
                                                                                title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__FKStaff__c.inlineHelpText}" styleClass="RFlookupClass" onclick="setFieldAPIName('BMCServiceDesk__FKStaff__c')"/>
                                                                        </td>
                                                                        <td >
                                                                                <apex:outputPanel rendered="{!NOT(enableQueueAndUserAssignment)}"> 
                                                                                <img class="closeIconDis" src="/s.gif" title="{!JSENCODE($Label.Clear)}" alt="Clear" onclick="resetStaffText();return false;" 
                                                                                onmouseout="this.className='closeIconDis'"  onmouseover="this.className='{!IF(enableQueueAndUserAssignment == true,'closeIconEnable','closeIconDis')}'" style="cursor: pointer;"/>
                                                                                </apex:outputPanel>  
                                                                            <a href="#" style="text-decoration: none;" onclick="setFieldAPIName('FKStaff__c');openOwnerLookupPopUP('STAFF',queueId,'', 'Broadcasts__c', broadcastId);return false;" ><img class="lookupIcon" title="{!$ObjectType.Broadcasts__c.fields.FKStaff__c.label} {!JSENCODE($Label.tooltipForLookup)}" 
                                                                                onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
                                                                                    onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" 
                                                                                onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!$ObjectType.Broadcasts__c.fields.FKStaff__c.label} {!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" style="cursor: pointer;" /></a>
                                                                          </td>
                                                                    </tr>
                                                                </table> 
                                                            </apex:outputPanel>
                                                    </apex:pageBlockSectionItem>                                
                                         </apex:pageBlockSection>
                                          </div>
											<div id="section3" style="display: none">
											<apex:pageBlockSection id="sec6" title="{!JSENCODE($Label.BMCServiceDesk__DisplayBroadcast)}" columns="2">
											<apex:outputPanel id="sec6Panel">
													<tr>
														<th class="labelCol vfLabelColTextWrap first last " scope="row">
															<apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__toEveryone__c.label}" />
														</th>
														<td class="dataCol first last">  
															<apex:inputCheckbox styleClass="clsBrCheckBoxNLabel" id="eveyoneCheckbox" title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__toEveryone__c.InlineHelpText}" value="{!broadcast.BMCServiceDesk__toEveryone__c}" onClick="clearToProfileName(this)"/>                          
														</td>
														<td class="labelCol empty"> </td>
														<td class="dataCol empty"> </td>
													</tr>   
													<tr> 
														<th class="labelCol vfLabelColTextWrap first last " scope="row">
															<apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__Profiles__c.label}"/>
														</th>
														<td class="dataCol first last ">    
															<table cellspacing="0" cellpadding="0">
																<tr>
																	<td>
																		<apex:inputText style="width:174px;" onfocus="this.blur()" title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__Profiles__c.InlineHelpText}" id="Proflie__c_id_name"   value="{!profileName}" />           
																	</td>
																	<td style="vertical-align: middle;">
																		<a href="#" style="text-decoration: none;" onclick="openToProfileWindow();return false;" ><img class="lookupIcon" title="{!$Label.SelectVaildProfile}" id="selectProfileLookup"
																			   onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
																				   onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';"
																			   onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" style="cursor: pointer;" /></a>
																	</td>
																</tr>
															</table>            
														</td>
														<td class="labelCol empty"> </td>
														<td class="dataCol empty"> </td>
													</tr>       
													<tr>
														<th class="labelCol vfLabelColTextWrap first last " scope="row">
															<apex:outputLabel value="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__Display_In_SelfService__c.label}"/>
														</th>

														<td class="dataCol first last">  
															<apex:inputCheckbox styleClass="clsBrCheckBoxNLabel" id="displayInSS" title="{!$ObjectType.BMCServiceDesk__Broadcasts__c.fields.BMCServiceDesk__Display_In_SelfService__c.InlineHelpText}" value="{!broadcast.BMCServiceDesk__Display_In_SelfService__c}"  tabindex="514" onClick="enableRadio();" />                
														</td>
														<td class="labelCol empty"> </td>
														<td class="dataCol empty"> </td>
													</tr>       
													<tr>
														<th class="labelCol vfLabelColTextWrap first last " scope="row">
															<apex:outputLabel for="selectRadio:0" value="{!$Label.BMCServiceDesk__BroadCastsToAllUsers}" />
														</th>
														<td class="dataCol first last clsDisplayBroadcast">  
															<input type="radio" class="clsBrCheckBoxNLabel" name="selectRadio" value="AllAccounts" id="selectRadio:0" onClick="radioAllAccounts();"/>                
														</td>
														<td class="labelCol empty"> </td>
														<td class="dataCol empty"> </td>
													</tr>   
													<tr>
														<th class="labelCol vfLabelColTextWrap first last " scope="row">
															<apex:outputLabel for="selectRadio:1" value="{!$Label.BMCServiceDesk__BroadCastsToUsersofSelectedAccountsOnly}" />
														</th>
														<td class="dataCol first last clsDisplayBroadcast">   
															<input type="radio"  class="clsBrCheckBoxNLabel" name="selectRadio" value="SelectedAccounts" id="selectRadio:1" onClick="radioSelectedAccounts();" />                
														</td>
														<td class="labelCol empty"> </td>
														<td class="dataCol empty"> </td>
													</tr>           
													<tr> 
														<td class="labelCol empty"> </td>
														<td class="dataCol first last ">    
															<table cellspacing="0" cellpadding="0">
																<tr>
																	<td id="multiSelectBox" style="width:174px;">
																		<select  id="accountSelectId" size="8" class="clsAccountTextareaDisable" >
																		 </select>
																	</td>
																	<td id="multiSelectBoxBtn"  dir="ltr" vertical-align="top" >
																			<a href="#" style="text-decoration: none;" onclick="openAccountSelectWindow();return false;"><img id ="selectAccountLookupId" class="lookupIcon" title="{!$Label.BroadcastAccountsSelect}" 
																			   onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
																				   onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';" onclick="openAccountSelectWindow();return false;" 
																			   onfocus="this.className = 'lookupIconOn';" onblur="this.className = 'lookupIcon';" alt="{!JSENCODE($Label.tooltipForLookup)}" src="/s.gif" style="cursor: pointer;" /></a>
																	</td>   
																</tr>
															</table>            
														</td>
														<td class="labelCol empty"> </td>
														<td class="dataCol empty"> </td>
													</tr>       
											</apex:outputPanel>
											</apex:pageBlockSection>
											</div>  
                                </div>
                                </td>
                        </tr>
                    </table>
					   <apex:facet name="footer">
						<table style="border: 1;" align="Center" cellspacing="0" cellpadding="0">
							<tr>
                                <td align="center"><span><a class="backtotop" href="#" onClick="if(parent.isServiceCloudConsole == 'true') {parent.scrollTo(0,0);}">{!$Label.Console_BackToTop}</a> </span> 
								<span id="links" style="display: {!IF(broadcast.Id == '', 'none', 'inline')}">
								<span class="separator"> | </span> 
								<span><a class="backtotop" id="RelatedListlink" href="javascript:void(0)" onClick="window.parent.BroadcastRelatedListBtnhandler();">{!$Label.RelatedLists}</a></span>
								 </span> 
								</td>
							</tr>
						</table>
					</apex:facet>
                </apex:pageBlock>
                <apex:inputHidden value="{!broadcast.BMCServiceDesk__FKUrgency__c}" id="urgency__id"/>
                <apex:inputHidden value="{!broadcast.BMCServiceDesk__FKImpact__c}" id="impact__id"/>
                <apex:inputHidden value="{!broadcast.BMCServiceDesk__FKStatus__c}" id="status__id"/>                
                 <apex:inputHidden value="{!broadcast.BMCServiceDesk__FKStaff__c}" id="ownerOpenby_Id"/>
                 <apex:inputHidden value="{!broadcast.ownerid}" id="owner_Id"/>
                 <apex:inputHidden value="{!queueId}" id="queueId"/> 
        		<script>
        			var ownerOpenById = '{!$Component.ownerOpenby_Id}';
        			var ownerId = '{!$Component.owner_Id}';
        			var strQueueId = '{!$Component.queueId}';
                    urgencyLookupId = '{!$Component.urgency__id}';
                    impactLookupId = '{!$Component.impact__id}';
                    statusLookupId = '{!$Component.status__id}';
                    var urgancyvalue='{!broadcast.BMCServiceDesk__FKUrgency__c}';
                    var impactvalue='{!broadcast.BMCServiceDesk__FKImpact__c}';
                    var statusvalue='{!broadcast.BMCServiceDesk__FKStatus__c}';
                </script>
        </apex:outputPanel>
        </apex:form>
    <script>
    	var enableQueueAndUserAssignment = {!enableQueueAndUserAssignment};
        var prefixMap;
        if(window.parent.isRFConsoleDetailForm =='true'){
            prefixMap = window.parent.parent.ObjectPrefixMap;
        }else{
            prefixMap = window.parent.ObjectPrefixMap;
        }
        prefixMap.push(new Array('005','User'));
        prefixMap.push(new Array('00G','Group'));
        
        var searchErrorMsg = '{!JSENCODE($Label.GsErrorMsg)}';
    	var queueId = '{!JSENCODE(queueId)}';
    	var staffId = '{!$Component.thpage:theForm:thePAgeBlock:sec5.pageblock5Item2.staffId}';
    	var mandatoryFieldValueValidationMsg = '{!JSENCODE($Label.mandatoryFieldValueValidationMsg)}';
		var saveSuccess = '{!JSENCODE($Label.SavedSuccessfully)}';
        var isRTFEnabled = true;
        var status = '{!broadcast.state__c}';
        var lblClear = '{!JSENCODE($Label.Clear)}';
        _RemotingActions={}
        _RemotingActions.getLookUpData = '{!$RemoteAction.ConsoleRemoteActions.getData}';
     
		var setBroadcastData ;
        var isAutocomplete = false;
        var saveBroadcast = function doSave(){
            var errorMsges = validateData();
            if (errorMsges!='') {
            	document.getElementById('messageSpace').className='message_space_off';
                return showPageMsg(errorMsges);
            }    
            document.getElementById('messageSpace').className='message_space_on';    
            startWaitMsgBar();
            isRTFEnabled =window.parent.RTFEnabledPage();
            if (isRTFEnabled){
                saveSuccessful = save(csvAccountListparam,window.parent.AttRefGeneratorID,window.parent.lastModifiedByLocking);
            }else{
                saveSuccessful = saveWithRerender(csvAccountListparam,window.parent.AttRefGeneratorID, window.parent.lastModifiedByLocking);
            } 
        }
     
      if(window.parent.saveBroadcast!=undefined){
            window.parent.saveBroadcast(saveBroadcast);
      }
    </script>
            <apex:outputPanel id="renderPanel">             
            <script>         
                status = '{!broadcast.state__c}';
                broadcastId = '{!JSENCODE(broadcast.Id)}';
                var queueId = '{!JSENCODE(queueId)}';
                var listData = {!accountJSON};
    	    	var flag='{!JSENCODE(broadcast.Limit_To_Account_Users__c)}';
    	    	var toEveryone={!broadcast.BMCServiceDesk__toEveryone__c};
    	    	var dispInSS = {!broadcast.BMCServiceDesk__Display_In_SelfService__c};
    	    	var broadcastState = {!broadcast.state__c};
    	    
                setBroadcastData = function setBroadcastData(){           
                    var arr = new Array();
                    arr['Id'] = '{!JSENCODE(broadcast.Id)}';
                    arr['Name'] = '{!JSENCODE(broadcast.Name)}';
                    arr[ 'Stage__c' ] = getTranslatedStage();
                    arr[ 'state__c' ] =  '{!broadcast.state__c}';
                    arr[ 'id' ] =  '{!broadcast.id}';
					arr[ 'broadcastDescription__c' ]='{!JSENCODE(broadcast.broadcastDescription__c)}';
                    arr[ 'isRecordLock' ] = '{!JSENCODE(isRecordLock)}'; 
                    return arr;            
                };
                if(window.parent.setBroadcastData!=undefined){
                    window.parent.setBroadcastData(setBroadcastData);
                } 
        
                function getTranslatedStage(){ 
                    if('{!JSENCODE(broadcast.FKStatus__r.Stage__c)}' =='Opened'){
                        return '{!JSENCODE($Label.Opened)}';
                    }else if('{!JSENCODE(broadcast.FKStatus__r.Stage__c)}' =='Acknowledged'){
                        return '{!JSENCODE($Label.StageProgression_Acknowledged)}';
                    }else if('{!JSENCODE(broadcast.FKStatus__r.Stage__c)}' =='In Process'){
                        return '{!JSENCODE($Label.StageProgression_InProcess)}';
                    }else if('{!JSENCODE(broadcast.FKStatus__r.Stage__c)}' =='Closed'){
                        return '{!JSENCODE($Label.Closed)}';
                    }else{
                        return '{!JSENCODE(broadcast.FKStatus__r.Stage__c)}';
                    }
                }
            </script>   
        </apex:outputPanel> 
        
        <apex:outputPanel id="genericPanel">             
        <script>         
           var messageStr  = '{!JSENCODE(messageString)}';
         
           function displayMessage(){
                if(messageStr!=null && messageStr !=''){
                    if(messageStr == saveSuccess){
                        window.parent.afterSaveSucceed();
                        handleElemEvent();
                        ShowInlineSaveMessage();
                    }else{
                        alert(messageStr);}
                }else if(messageStr ==null || messageStr == '') {
            		var clickedOnceTemp = window.parent.clickedOnce ;
            		handleElemEvent();
            		window.parent.clickedOnce = clickedOnceTemp ;
            	}
            } 
           </script>   
    </apex:outputPanel>
	<script type="text/javascript" src="{!$Resource.SDEFCommonJS}/HTML_ENCODE_DECODE.js"></script>
    <script src="{!$Resource.SDEFCommonJS}/ConsoleBroadcastDetail.js"  type="text/javascript" />
    <script src="{!$Resource.SDEFCommonJS}/ConsoleDetail.js"  type="text/javascript" />
    <script src="{!$Resource.SDEFCommonJS}/TypeAhead.js"  type="text/javascript" />
    <apex:outputPanel id="frequentRereshPanel">
        <script>
            showFieldAsRequired(orgNamespace+'FKCategory__c',isCategoryMandatory);
            showFieldAsRequired(orgNamespace+'broadcastMessage__c',isBroadcastMessageMandatory);
            showFieldAsRequired(orgNamespace+'Name',isBroadcastIDMandatory);
            createUrgencyPickList('{!$ObjectType.Broadcasts__c.fields.FKUrgency__c.Updateable}');
            createImpactPickList('{!$ObjectType.Broadcasts__c.fields.FKImpact__c.Updateable}');
            createStatusPickList('Broadcast', '{!$ObjectType.Broadcasts__c.fields.FKStatus__c.Updateable}');
            userTypeReference ='{!JSENCODE(userTypeReference)}';
            if(userTypeReference !=null && userTypeReference != 'undefined' && userTypeReference!='')
            	hideUserTypeSelector(userTypeReference);       
            createSectionLinks();  
			adjustFSLinkDiv();
            initDisplayBroadcast();
            setTypeAheadForLookups();
            createStandardOwnerField('Broadcasts__c', broadcastId );
            createStandardStaffField('Broadcasts__c', broadcastId );
			if(firstElement != null && firstElement != '')
				document.getElementById(firstElement).focus();
        </script>
    </apex:outputPanel>
    <script>
    	handleElemEvent();
		if(document.addEventListener){
            document.addEventListener("click", function(){
                if(isAutocomplete != 'undefined' && isAutocomplete != undefined && isAutocomplete){
                    disableAutoDiv();
                }
            });
        }else if(document.attachEvent){
            document.attachEvent("onclick", function(){
                if(isAutocomplete != 'undefined' && isAutocomplete != undefined && isAutocomplete){
                    disableAutoDiv();
                }
            });
        }
    </script>
    </body>
</apex:page>