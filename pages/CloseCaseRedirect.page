<apex:page standardController="case" extensions="CloseCaseRedirectExtension" >

<apex:includeScript value="/support/console/28.0/integration.js"/>

    <script type="text/javascript">

    		var targetUrl = '{!closeURL}';
            if (sforce.console.isInConsole()) {
       
                sforce.console.getEnclosingPrimaryTabId(function(result) {
                    var primaryTabId = result.id;
                    sforce.console.getEnclosingTabId(function(result) {
                        var tabId = result.id;
                        sforce.console.getSubtabIds(primaryTabId, function(result) {
                            var subTabIds = result.ids;
                            if (tabId == subTabIds[0]) {
                                sforce.console.openPrimaryTab(primaryTabId , targetUrl, true,'{!casenumber}');
                            
								
                            } else {
                                
                                //sforce.console.openPrimaryTab(primaryTabId , {!ca.id}, true,'{!casenumber}');
                                sforce.console.openSubtab(primaryTabId , targetUrl, true,'{!casenumber}',subTabIds[0]);
               
                            }
                        });
                    });
                });
            } else {
                location = '/'+ targetUrl;
            }
    
    	function CloseTab() {
         
        sforce.console.getEnclosingTabId(closeSubtab);
        }  
        var closeSubtab = function closeSubtab(result) {
        var tabId = result.id;
        sforce.console.closeTab(tabId);
        }

    
    
    
            </script>
  

</apex:page>